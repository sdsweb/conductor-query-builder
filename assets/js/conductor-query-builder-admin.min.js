/**
 * Conductor Query Builder Admin
 */

var conductor_query_builder=conductor_query_builder||{}
!function(e,t){"use strict"
var o,r,n,i,s,c,u,a,l,d,p,h,b,f
conductor_query_builder.hasOwnProperty("Backbone")||(conductor_query_builder.Backbone={Views:{},Models:{},Collections:{},instances:{models:{clauses:[],sub_clauses:[],shortcode:[]},collections:{clauses:[],sub_clauses:[],shortcode:[]},views:{clauses:[],sub_clauses:[],clause_action_buttons:[]}},defaults:{meta:{parameters:!1,operators:!1,values:!1},parent:{count:-1,id:"",limit:-1}}}),conductor_query_builder.hasOwnProperty("fn")||(conductor_query_builder.fn={query_builder:{init:function(e){e=e||!1
var o=t(".widget","#widgets-right"),r=o.find(".conductor-accordion-section")
u=new conductor_query_builder.Backbone.Collections.Query_Builder_Clause_Group,conductor_query_builder.Backbone.instances.collections.clauses=u,a=new conductor_query_builder.Backbone.Collections.Query_Builder_Sub_Clause_Group,conductor_query_builder.Backbone.instances.collections.sub_clauses=a,s=new conductor_query_builder.Backbone.Views.Query_Builder({type:"query-builder",shortcode:e}),conductor_query_builder.Backbone.instances.views.query_builder=s,c=new conductor_query_builder.Backbone.Views.Query_Builder_Actions({type:"query-builder-actions",shortcode:e}),conductor_query_builder.Backbone.instances.views.query_builder_actions=c,s.views.set(c.el_selector,c,{silent:!0}),s.render(),setTimeout(function(){r.each(function(){var e=t(this),o=e.find(".conductor-accordion-section-title"),r=e.find(".conductor-accordion-section-content")
o.length&&!e.hasClass("open")&&r.slideToggle(0)}),i=new conductor_query_builder.Backbone.Views.Query_Builder_Wrapper({type:"query-builder-wrapper",shortcode:e}),conductor_query_builder.Backbone.instances.views.query_builder_wrapper=i},1)},reset:function(e){s.reset(),void 0!==e&&(conductor_query_builder.meta=e),s.render()}},shortcode:{init:function(){d=new conductor_query_builder.Backbone.Collections.Shortcode,conductor_query_builder.Backbone.instances.collections.shortcode.push(d),l=new conductor_query_builder.Backbone.Models.Shortcode,d.add(l),conductor_query_builder.Backbone.instances.models.shortcode.push(l),p=new conductor_query_builder.Backbone.Views.Shortcode({model:l,queries:conductor_query_builder.queries,type:"shortcode"}),conductor_query_builder.Backbone.instances.views.shortcode=p,h=new conductor_query_builder.Backbone.Views.Shortcode_Actions({type:"shortcode-actions",button_type:"insert",label:conductor_query_builder.l10n.shortcode.insert}),conductor_query_builder.Backbone.instances.views.shortcode_actions=h,p.views.set(h.el_selector,h,{silent:!0}),b=new conductor_query_builder.Backbone.Views.Shortcode_Insert({queries:p.options.queries,type:"shortcode-insert"}),conductor_query_builder.Backbone.instances.views.shortcode_insert=b,p.views.set(b.el_selector,b,{silent:!0}),f=new conductor_query_builder.Backbone.Views.Shortcode_Create_Title({type:"shortcode-create-title",title:conductor_query_builder.title||""}),conductor_query_builder.Backbone.instances.views.shortcode_create_title=f,p.views.set(f.el_selector,f,{silent:!0}),p.render()},reset:function(){p.reset(),b.reset()}},conductor:{widget:{reset:function(e){e=e||{}
var o=!1,r=[]
setTimeout(function(){_.each(conductor_query_builder.widgets.conductor.defaults,function(n,i){if("output_features"!==i)if(o=!1,!_.isEmpty(e)&&e.hasOwnProperty(i)&&(n=e[i]),_.isObject(n))switch(i){case"output":p.$el.find(".conductor-output-data").val(JSON.stringify(n)),p.$el.find(".featured-one-select").val(""),_.each(n,function(e,t){var n
switch(o=p.$el.find('[data-id="'+e.id+'"]'),r.push(e.id),e.id){case"post_content":o.find(".conductor-widget-output-element-label-select select").val(e.value)}o.addClass("visible"),o.data("visible","true").attr("data-visible","true"),e.link&&(o.addClass("link"),o.data("link","true").attr("data-link","true")),n=o.find(".conductor-widget-output-element-label .label"),n.length?n.parent().removeClass("editing"):(n=o.find(".conductor-widget-output-element-label"),n.removeClass("editing")),n.html(e.label),o.data("label",e.label).attr("data-label",e.label),o.data("priority",t).attr("data-priority",t),p.$el.find(".conductor-widget-output-list").append(o)}),p.$el.find(".conductor-widget-output-element").each(function(){var e=t(this);-1===r.indexOf(e.data("id"))&&e.remove()})
break
default:_.each(n,function(e,t){switch(e="boolean"!=typeof e||e?e:"",i){case"flexbox":switch(t){case"columns":o=p.$el.find(':input[id$="'+i+"_"+t+'"]'),o.length&&o.val()!==e&&(o.val(e).trigger("change input"),o.next(".conductor-flexbox-columns-value").html(e))}break
default:switch(o=p.$el.find(':input[id$="'+t+'"]'),t){case"cat":e="0"}o.length&&o.val()!==e&&o.val(e).trigger("change")}})}else{switch(o=p.$el.find(':input[id$="'+i+'"]'),i){case"widget_size":o=p.$el.find(".conductor-widget-size-value:checked")}if(o.length&&(n="boolean"!=typeof n||n?"boolean"==typeof n?"true":n:"",o.val()!==n))switch(o.val(n).trigger("change"),i){case"widget_size":o=p.$el.find('.conductor-widget-size-value[id$="'+n+'"]').trigger("change").prop("checked",!0)}}})},1)}}}}),conductor_query_builder.Backbone.Models.Query_Builder_Clause_Group=Backbone.Model.extend({defaults:{columns:!1,el_selector:"",flags:[],operators:[],parameters:[],title:"",limit:-1,type:!1},id_prefix:"conductor-qb-",initialize:function(){_.bindAll(this,"setID","removeFromInstances"),this.listenTo(this,"remove",this.removeFromInstances),this.listenTo(this,"remove",this.stopListening)},setID:function(e){-1!==e.options.count&&this.set("id",this.getIDFromView(e))},getIDFromView:function(e){return this.id_prefix+this.get("type")+"-"+e.options.count},removeFromInstances:function(){var e,t=conductor_query_builder.Backbone.instances.models.clauses,o=this
e=t.map(function(e){return e.get("id")}).indexOf(o.get("id")),-1!==e&&t.splice(e,1)}}),conductor_query_builder.Backbone.Models.Query_Builder_Sub_Clause_Group=Backbone.Model.extend({defaults:{columns:!1,flags:[],meta:_.clone(conductor_query_builder.Backbone.defaults.meta),operators:[],parameters:[],parent_id:"",parent:_.clone(conductor_query_builder.Backbone.defaults.parent),title:"",type:!1},id_prefix:"conductor-qb-",initialize:function(){_.bindAll(this,"setID","setParentID","removeFromInstances"),this.listenTo(this,"remove",this.removeFromInstances),this.listenTo(this,"remove",this.stopListening)},setID:function(e,t){t=t||!1,e.views.parent&&e.views.parent.model&&-1!==e.options.count&&(this.setParentID(e.views.parent.model.get("id")),this.set("id",t?t:this.getIDFromView(e)))},getIDFromView:function(e){return this.id_prefix+e.views.parent.model.get("id").replace(this.id_prefix,"")+"-"+e.options.count},setParentID:function(e){var t=_.clone(this.get("parent"))
t.id=e,this.set("parent",t),this.set("parent_id",e)},setParentData:function(e){var t=_.clone(this.get("parent"))
t.count=e.views.parent.options.count,t.limit=e.views.parent.model.get("limit"),this.set("parent",t)},removeFromInstances:function(){var e,t=conductor_query_builder.Backbone.instances.models.sub_clauses,o=this
e=t.map(function(e){return e.get("id")}).indexOf(o.get("id")),-1!==e&&t.splice(e,1)}}),conductor_query_builder.Backbone.Collections.Query_Builder_Clause_Group=Backbone.Collection.extend({}),conductor_query_builder.Backbone.Collections.Query_Builder_Sub_Clause_Group=Backbone.Collection.extend({isMetaEmpty:function(){return this.every(function(e){var t=e.get("meta")
return!t.parameters&&!t.operators&&!t.values})}}),conductor_query_builder.Backbone.Views.Query_Builder_Wrapper=e.Backbone.View.extend({el:"#conductor-qb-query-builder",has_user_changed_feature_type:!1,feature_type_value:"",events:{"change .conductor-select-feature-type":"setHasUserChangedFeatureTypeFlag","change :input":"previewQuery","change .conductor-widget-size-value":"maybeShowConductorWidgetColumnsSetting"},initialize:function(e){_.bindAll(this,"render","setHasUserChangedFeatureTypeFlag","previewQuery")},render:function(){return e.Backbone.View.prototype.render.apply(this,arguments),this},setHasUserChangedFeatureTypeFlag:function(e){this.feature_type_value=t(e.currentTarget).val(),this.has_user_changed_feature_type||(this.has_user_changed_feature_type=!0)},previewQuery:_.debounce(function(){var o=t(document)
o.trigger("conductor-query-builder-preview-query",[this,n]),this.options.shortcode||(n.addClass(conductor_query_builder.css.classes.loading),e.ajax.post(conductor_query_builder.ajax.preview.action,this.ajax.setupAJAXData(conductor_query_builder.ID,conductor_query_builder.ajax.preview.nonce,conductor_query_builder.ajax.preview.action)).done(this.ajax.success).fail(this.ajax.fail))},300),maybeShowConductorWidgetColumnsSetting:function(e){var o=t(e.currentTarget),r=o.val(),n=conductor.widgets.conductor.displays,i=r&&n&&n[r]&&_.isObject(n[r])?n[r]:!1,s=o.parents(".widget"),c=s.find(".conductor-columns"),u=window.getUserSetting(conductor_query_builder.user.settings["query-builder"].mode.name)
u&&"advanced"===u&&setTimeout(function(){conductor.widgets.conductor.renderElement(c,s,o,{display:{supports:"columns",config:i?i:{}},feature_type:"true"})},1)},ajax:{setupAJAXData:function(e,o,r,n){n=n||i.$el.find(":input")
var s=t.extend({ID:e,nonce:o,nonce_action:r},this.data),c=n.serializeArray()
return _.each(c,function(e){var o=t('[name="'+e.name+'"]'),r=o.data("type"),n=o.prop("multiple"),i=e.value
o[0].nodeName.toLowerCase()&&"values"===r&&n&&(i=o.data("selected-options")),s[e.name]?(_.isArray(s[e.name])||(s[e.name]=[s[e.name]]),-1===s[e.name].indexOf(e.value)&&s[e.name].push(e.value)):s[e.name]=i}),s},success:function(e){e.preview?n.removeClass(conductor_query_builder.css.classes.loading).html(e.preview):n.removeClass(conductor_query_builder.css.classes.loading)},fail:function(){n.removeClass(conductor_query_builder.css.classes.loading).html(conductor_query_builder.l10n.ajax.fail.preview)}}}),conductor_query_builder.Backbone.Views.Query_Builder=e.Backbone.View.extend({el:"#conductor-qb-meta-box-query-builder-tab-content",query_builder_mode_attr:"data-query-builder-mode",initial_feature_type:!1,has_user_changed_feature_type:!1,initialize:function(e){var t,o,r=this,n=window.getUserSetting(conductor_query_builder.user.settings["query-builder"].mode.name)
_.bindAll(this,"render"),setTimeout(function(){t=r.options.shortcode?p:i,o=t.$el.find(".conductor-select-feature-type"),r.initial_feature_type=o.val(),"advanced"===n&&"true"!==o.val()&&o.val("true")},10)},render:function(){return e.Backbone.View.prototype.render.apply(this,arguments),this.renderClauseGroups(),this},renderClauseGroups:function(){var e,t=this
setTimeout(function(){_.each(conductor_query_builder.clauses,function(t,o){(t.config["default"]||conductor_query_builder.meta[o]&&!_.isEmpty(conductor_query_builder.meta[o]))&&(t.config["default"]?c.addClauseGroup(!1,o,t,conductor_query_builder.meta[o]):_.each(conductor_query_builder.meta[o],function(r,n){e=c.addClauseGroup(!1,o,t,conductor_query_builder.meta[o]),_.each(r,function(t,o){0!==o&&e.addSubClauseGroup()})}))}),t.removeLoadingState()},1)},reset:function(){var e,t,o,r=this
for(_.each(conductor_query_builder.meta,function(e,t){conductor_query_builder.meta[t]=[]}),c.trigger("conductor-qb-disable-action-buttons"),_.each(conductor_query_builder.Backbone.instances.views.clause_action_buttons,function(e){e.trigger("conductor-qb-disable-action-buttons")});u.length;)e=u.first(),t=e.get("el_selector"),t&&(o=r.views.get(t),o.length&&_.each(o,function(e){e.removeClauseGroup(!1,!0)}))},toggleQueryBuilderMode:function(e,t){var o=this.options.shortcode?p:i,r=o.$el.find(".conductor-select-feature-type")
this.$el.find("["+this.query_builder_mode_attr+'="'+t+'"]').addClass("hide hidden conductor-qb-hide conductor-qb-hidden"),this.$el.find("["+this.query_builder_mode_attr+'="'+e+'"]').removeClass("hide hidden conductor-qb-hide conductor-qb-hidden"),this.$el.parents(".conductor-qb-query-builder-meta-box-tab-content-wrapper").toggleClass("conductor-qb-"+t+"-mode conductor-qb-"+e+"-mode"),"advanced"===e&&"true"!==r.val()?r.val("true"):"simple"===e&&(o.has_user_changed_feature_type?r.val(o.feature_type_value):r.val(""))},removeLoadingState:function(){this.$el.parents(".conductor-qb-query-builder-meta-box-tab-content-wrapper").removeClass(conductor_query_builder.css.classes.loading)}}),conductor_query_builder.Backbone.Views.Query_Builder_Actions=e.Backbone.View.extend({className:"conductor-qb-meta-box-query-builder-actions-inner",action_button_selector:".conductor-qb-action-button",el_selector:"",el_selector_prefix:".conductor-qb-meta-box-query-builder-",el_selector_suffix:"-actions",flags:{action_buttons_enabled:!1},template:e.template("conductor-qb-meta-box-query-builder-actions"),events:{"click .conductor-qb-add-clause-group-button":function(e){var o,r=t(e.currentTarget),n=r.data("clause-group-type"),i=conductor_query_builder.clauses[n]&&conductor_query_builder.clauses[n].config,s=i&&i.limit?parseInt(i.limit,10):-1
o=this.addClauseGroup(e),o&&-1!==s&&o.getCurrentCount()>=s&&this.disableActionButton("#"+r.attr("id"))},"click .conductor-qb-test-query-button":"testQuery","click .conductor-qb-toggle-mode-button":"toggleQueryBuilderMode"},initialize:function(e){_.bindAll(this,"render","addClauseGroup"),e.flags||(e.flags={}),this.el_selector=e.clause_group_type?this.el_selector_prefix+e.clause_group_type+this.el_selector_suffix:this.el_selector_prefix+this.el_selector_suffix,e.clause_group_type&&!t(this.el_selector).length&&(this.el_selector=this.el_selector_prefix+e.clause_group_type.replace("_","-")+this.el_selector_suffix),e.clause_group_type||(this.el_selector=this.el_selector.replace("--","-")),!e.flags.clause_group&&e.clause_group_type&&(e.flags.clause_group=!0),this.listenTo(this,"conductor-qb-enable-action-buttons",this.enableActionButtons),this.listenTo(this,"conductor-qb-disable-action-buttons",this.disableActionButtons)},render:function(){return e.Backbone.View.prototype.render.apply(this,arguments),this},addClauseGroup:function(e,o,r,n){o=o||!1,r=r||!1,n=n||!1
var i,c,a,l,d=e&&!_.isEmpty(e),p=d&&e.currentTarget?t(e.currentTarget):!1,h=o?o:p?p.data("clause-group-type"):!1,b=r.config,f=b&&b.title||"",y=b&&b.limit?parseInt(b.limit,10):-1
return d&&e.preventDefault(),h?(i=new conductor_query_builder.Backbone.Models.Query_Builder_Clause_Group({columns:conductor_query_builder.clauses[h]&&conductor_query_builder.clauses[h].config&&conductor_query_builder.clauses[h].config.columns?conductor_query_builder.clauses[h].config.columns:!1,flags:conductor_query_builder.clauses[h]&&conductor_query_builder.clauses[h].config&&conductor_query_builder.clauses[h].config.flags?conductor_query_builder.clauses[h].config.flags:!1,operators:conductor_query_builder.clauses[h]&&conductor_query_builder.clauses[h].operators?conductor_query_builder.clauses[h].operators:!1,parameters:conductor_query_builder.clauses[h]&&conductor_query_builder.clauses[h].parameters?conductor_query_builder.clauses[h].parameters:!1,meta:n?n:conductor_query_builder.meta[h]?conductor_query_builder.meta[h]:_.clone(conductor_query_builder.Backbone.defaults.meta),title:!f&&conductor_query_builder.clauses[h]&&conductor_query_builder.clauses[h].config&&conductor_query_builder.clauses[h].config.title?conductor_query_builder.clauses[h].config.title:f,type:h,limit:!isNaN(y)&&y>0?y:-1,shortcode:this.options.shortcode}),u.add(i),conductor_query_builder.Backbone.instances.models.clauses.push(i),c=_.clone(i.attributes),c.model=i,a=new conductor_query_builder.Backbone.Views.Query_Builder_Clause_Group(c),conductor_query_builder.Backbone.instances.views.clauses.push(a),i.setID(a),c.flags.actions&&(l=new conductor_query_builder.Backbone.Views.Query_Builder_Actions({type:"query-builder-actions",clause_group_type:c.type,shortcode:this.options.shortcode}),conductor_query_builder.Backbone.instances.views.clause_action_buttons.push(l),a.views.set(l.el_selector,l,{silent:!0})),s.views.add(a.el_selector,a),a):!1},enableActionButtons:function(){this.flags.action_buttons_enabled=!0,this.enableActionButton(this.action_button_selector)},enableActionButton:function(e){var o=this.$el.find(e)
o.length||(e=e.replace("_","-"),o=this.$el.find(e)),o.length&&(o.length>1?o.each(function(){var e=t(this),o=e.data("clause-group-type"),r=conductor_query_builder.clauses[o]&&conductor_query_builder.clauses[o].config,n=r&&r.limit?parseInt(r.limit,10):-1,i=u.where({type:o}).length
0===i&&conductor_query_builder.meta[o]&&(i=conductor_query_builder.meta[o].length),(-1===n||n>i)&&e.prop("disabled",!1)}):this.$el.find(e).prop("disabled",!1))},disableActionButtons:function(){this.flags.action_buttons_enabled=!1,this.disableActionButton(this.action_button_selector)},disableActionButton:function(e){var t=this.$el.find(e)
t.length&&this.$el.find(e).prop("disabled",!0)},testQuery:function(e){e.preventDefault()},toggleQueryBuilderMode:function(e){var o,r=t(e.currentTarget),n=conductor_query_builder.user.settings["query-builder"].mode.value
e.preventDefault(),o=_.find(conductor_query_builder.user.settings["query-builder"].mode.values,function(e,t){return conductor_query_builder.user.settings["query-builder"].mode.values.indexOf(n)!==t}),r.html(r.data(o+"-label")),window.setUserSetting(conductor_query_builder.user.settings["query-builder"].mode.name,o),conductor_query_builder.user.settings["query-builder"].mode.value=o,s.toggleQueryBuilderMode(o,n)}}),conductor_query_builder.Backbone.Views.Query_Builder_Clause_Group=e.Backbone.View.extend({className:"conductor-qb-meta-box-query-builder-clause-group-inner",el_selector:"",el_selector_prefix:".conductor-qb-meta-box-query-builder-",el_selector_suffix:"-groups",select2_selector:".conductor-qb-select2",$select2:!1,template:e.template("conductor-qb-meta-box-query-builder-clause-group"),events:{"click .conductor-qb-remove-action-button":function(e){var o,r,n,i=t(e.currentTarget),s="#"+i.data("action-button-id"),u=t(s)
u.length||(s=s.replace("_","-"),u=t(s)),u.length&&(r=u.data("clause-group-type"),o=conductor_query_builder.clauses[r]&&conductor_query_builder.clauses[r].config,n=o&&o.limit?parseInt(o.limit,10):-1),c.flags.action_buttons_enabled&&n&&this.getCurrentCount()<=n&&(c.enableActionButton(s),_.each(conductor_query_builder.Backbone.instances.views.clause_action_buttons,function(e){e.enableActionButton(s)})),this.removeClauseGroup(e)},"click .conductor-qb-add-action-button":"addSubClauseGroup"},initialize:function(e){_.bindAll(this,"render","addSubClauseGroup","removeSubClauseGroup","removeClauseGroup","select2Change","getCurrentCount"),e.flags||(e.flags={}),e.type&&(this.el_selector=this.el_selector_prefix+e.type+this.el_selector_suffix,t(this.el_selector).length||(this.el_selector=this.el_selector_prefix+e.type.replace("_","-")+this.el_selector_suffix),this.model.set("el_selector",this.el_selector)),this.options.count=this.getCurrentCount(!0),_.isUndefined(this.options.flags.sub_clause_groups)&&(this.options.flags.sub_clause_groups=!0),_.isUndefined(this.options.flags.remove)&&(this.options.flags.remove=!0),_.isUndefined(this.options.flags.re_init_values)&&(this.options.flags.re_init_values=!1),e.template&&(this.template=e.template),this.listenTo(this,"ready",this.addSubClauseGroup)},addSubClauseGroup:function(e){e=e||!1
var o,r,n,i,s=e&&!_.isEmpty(e)
s&&e.currentTarget?t(e.currentTarget):!1;(!s||this.options.flags.sub_clause_groups)&&(s&&e.preventDefault(),o={columns:this.options.columns,flags:this.options.flags,operators:this.options.operators,parameters:this.options.parameters,type:this.options.type,shortcode:this.options.shortcode},r=new conductor_query_builder.Backbone.Models.Query_Builder_Sub_Clause_Group(o),a.add(r),conductor_query_builder.Backbone.instances.models.sub_clauses.push(r),n=_.clone(r.attributes),n.model=r,i=new conductor_query_builder.Backbone.Views.Query_Builder_Sub_Clause_Group(n),conductor_query_builder.Backbone.instances.views.sub_clauses.push(i),r.setID(i),this.views.add(i.el_selector,i),this.options.sub_clause_el_selector&&this.options.sub_clause_el_selector===i.el_selector||(this.options.sub_clause_el_selector=i.el_selector))},removeSubClauseGroup:function(e,t){e.preventDefault(),this.options.flags.sub_clause_groups&&!t.options["default"]&&(t.remove(),i.previewQuery())},render:function(t){return t=t||!1,this.options.count=t?this.options.count-1:this.options.count,t&&this.model.setID(this),e.Backbone.View.prototype.render.apply(this,arguments),this},removeClauseGroup:function(e,t){t=t||!1
var o=e&&!_.isEmpty(e);(this.options.flags.remove||t)&&(o&&e.preventDefault(),this.remove(t),i.previewQuery())},remove:function(t){t=t||!1
var o,r,n,i=conductor_query_builder.Backbone.instances.views.clauses,s=this.model.get("type"),c=this.options.count
if(this.options.flags.remove||t)return this.options.flags.removing||(this.options.flags.removing=!0),u.remove(this.model),o=e.Backbone.View.prototype.remove.apply(this,arguments),r=i.map(function(e){return e.cid}).indexOf(this.cid),-1!==r&&i.splice(r,1),-1!==c&&conductor_query_builder.meta[s][c]&&conductor_query_builder.meta[s].splice(c,1),n=i.filter(function(e){return e.options.type===s}),n.length&&_.each(n,function(e){!e.options.flags.removing&&e.options.count>c&&(e.render(!0),e.options.flags.re_rendering=!0,e.options.sub_clause_el_selector&&_.each(e.views.get(e.options.sub_clause_el_selector),function(e){e.render(!0)}),e.options.flags.re_rendering=!1)}),o},select2Change:function(e,o){var r,n,i,s=t(e.currentTarget),c=o.$select2.filter('[data-type="parameters"]'),u=c.find("option"),a=u.filter(":selected"),l=a.data("parameter"),d=a.data("field"),_=o.$select2.filter('[data-type="operators"]'),p=_.find("option"),h=_.val(),b=o.$select2.filter('[data-type="values"]'),f=b.find("option"),y=b.val(),g=s.val(),m=s.data("type"),v=s.data("select-type"),q=this.model.get("columns")
switch(m){case"parameters":if(this.options.flags.re_init_values=!1,r=this.getParameterData(g,l,d,v),n=this.getOperators(r),i=this.getValues(g,v),!(n&&n.length&&_.length&&g))return
this.updateOperatorsSelect(_,p,h,n),_.prop("disabled")&&_.prop("disabled",!1),o.initializeSelect2(["operators"]),q&&q.values&&i&&(this.options.flags.re_init_values=this.updateValuesSelect(b,f,y,i))
break
case"operators":q&&q.values&&(b.prop("disabled")&&conductor_query_builder.operators[g]&&("string"==typeof conductor_query_builder.operators[g]||conductor_query_builder.operators[g].type&&"bool"!==conductor_query_builder.operators[g].type)?b.prop("disabled",!1):!b.prop("disabled")&&conductor_query_builder.operators[g]&&"string"!=typeof conductor_query_builder.operators[g]&&conductor_query_builder.operators[g].type&&"bool"===conductor_query_builder.operators[g].type&&b.prop("disabled",!0))}},getCurrentCount:function(e){e=e||!1
var t
return t=u.where({type:this.options.type}).length,t=e&&0!==t?t-1:t},getParameterData:function(e,t,o,r){var n,i=e&&"string"==typeof e&&conductor_query_builder.parameters[e]?conductor_query_builder.parameters[e]:!1,s=void 0!==conductor_query_builder.parameters[r]
return(!i||s||!i.operators&&t&&r&&(conductor_query_builder.parameters[t]||conductor_query_builder.parameters[r]))&&(i=!i&&conductor_query_builder.parameters[t]?conductor_query_builder.parameters[t]:i,(!i||s||!i.operators&&t!==r&&conductor_query_builder.parameters[r])&&(n=conductor_query_builder.parameters[r]),n&&_.isObject(n)&&!n.operators&&n.fields&&n.fields[o]&&(i=n.fields[o])),i},getOperators:function(e){var t
return t=_.isObject(e)&&e.operators?e.operators:[e],t=_.isObject(t)?_.values(t):t},getValues:function(e,t){var o="string"==typeof e?conductor_query_builder.values[e]:!1
return!o&&t&&conductor_query_builder.values[t]&&(o=conductor_query_builder.values[t],o&&_.isObject(o)&&o.hasOwnProperty(e)&&(o=o[e])),o},updateOperatorsSelect:function(e,o,r,n,i){i=i||!1,o.each(function(){var e=t(this),o=(e.prop("multiple"),e.val())
e.prop("disabled",-1===n.indexOf(o))}),r&&o.filter('[value="'+r+'"]').prop("disabled")&&(e.val(o.not(":disabled").first().val()),i||e.trigger("change"))},updateValuesSelect:function(e,o,r,n,i){i=i||!1
var s=e.val(),c=!1
return _.each(n,function(t,r){var n,i,s
r=_.isObject(t)?r:t,r=_.isObject(t)&&t.hasOwnProperty("value")?t.value:r,i=o.filter('[value="'+r+'"]'),s=i.length?i.text():"",i.length?(_.isObject(t)&&t.hasOwnProperty("label")||s===r)&&s===t.label||(i.text(_.isObject(t)&&t.hasOwnProperty("label")?t.label:r),c||(c=!0)):(n='<option value="'+r+'">',n+=_.isObject(t)&&t.hasOwnProperty("label")?t.label:r,n+="</option>",e.append(n))}),o.each(function(){var e,o=t(this),i=o.val()
e=_.findIndex(n,function(e){return"string"==typeof e?e==i:e.value==i}),-1===e&&(o.remove(),r&&("string"==typeof r&&i==r||"string"!=typeof r&&r.length&&-1!==r.indexOf(i))&&("string"==typeof r?r="":r.splice(r.indexOf(i),1)))}),(!s&&r||r&&("string"==typeof s&&"string"==typeof r&&s!==r||"string"!=typeof r&&r.length&&!_.isEqual(s,r)))&&(e.val(r),i||e.trigger("change")),c}}),conductor_query_builder.Backbone.Views.Query_Builder_Sub_Clause_Group=e.Backbone.View.extend({className:"conductor-qb-meta-box-query-builder-sub-clause-group-inner",el_selector:"",el_selector_prefix:".conductor-qb-meta-box-query-builder-",el_selector_suffix:"-sub-clause-groups",select2_selector:".conductor-qb-select2",$select2:!1,shortcode_select2_re_init:!1,values:{},template:e.template("conductor-qb-meta-box-query-builder-sub-clause-group"),events:{"click .conductor-qb-remove-action-button":"removeSubClauseGroup","change .conductor-qb-select2":"select2Change","select2:select .conductor-qb-select2":"select2SelectUnselect","select2:unselect .conductor-qb-select2":"select2SelectUnselect","select2:close .conductor-qb-select2":function(e){var o=t(e.currentTarget)
this.select2Close(e),this.updateSelect2Options(o)},"keypress .select2-search__field":function(e){var o=t(e.currentTarget),r=o.parents(".select2-container").prev(".conductor-qb-select2")
this.updateSelect2Options(r)},"keyup .select2-search__field":function(e){var o=t(e.currentTarget),r=o.parents(".select2-container").prev(".conductor-qb-select2")
this.updateSelect2Options(r)},"change .select2-search__field":function(e){var o=t(e.currentTarget),r=o.parents(".select2-container").prev(".conductor-qb-select2")
this.updateSelect2Options(r)},"input .select2-search__field":function(e){var o=t(e.currentTarget),r=o.parents(".select2-container").prev(".conductor-qb-select2")
this.updateSelect2Options(r)},"select2:opening .conductor-qb-select2":function(e){var o=this,r=t(e.currentTarget)
o.updateSelect2Options(r)},"select2:open .conductor-qb-select2":function(e){var o=this,r=t(e.currentTarget)
o.updateSelect2Options(r),setTimeout(function(){o.updateSelect2Options(r)},1)},"select2:closing .conductor-qb-select2":function(e){var o=this,r=t(e.currentTarget)
r.data("select2").trigger("query",{}),o.updateSelect2Options(r),setTimeout(function(){o.updateSelect2Options(r)},1)}},initialize:function(e){_.bindAll(this,"render","removeSubClauseGroup","select2Change","select2SelectUnselect","select2Close","setMetaValue","getCurrentCount"),e.flags||(e.flags={}),e.type&&(this.el_selector=this.el_selector_prefix+e.type+this.el_selector_suffix,t(this.el_selector).length||(this.el_selector=this.el_selector_prefix+e.type.replace("_","-")+this.el_selector_suffix)),this.options.count=this.getCurrentCount(!0),this.options.count=-1!==this.options.count?this.options.count:0,this.options.parent||(this.options.parent={}),this.options.parent.count=this.views.parent&&this.views.parent.options.hasOwnProperty("count")&&-1!==this.views.parent.options.count?this.views.parent.options.count:-1,this.options.parent.limit=this.views.parent&&this.views.parent.options.hasOwnProperty("limit")&&-1!==this.views.parent.options.limit?this.views.parent.options.limit:-1,this.options.flags["default"]=0===this.options.count,e.template&&(this.template=e.template),this.listenToOnce(this,"ready",this.initializeSelect2),this.listenToOnce(this,"ready",this.maybeEnableActionButtons),this.listenToOnce(this,"ready",this.maybeSetModelID),this.listenToOnce(this,"ready",this.maybeSetModelParentData)},initializeSelect2:function(e){e=e||[]
var o,r,n,i,s,c=this,u=this.$el.find(this.select2_selector),a=u.filter('[data-type="operators"]'),l=a.find("option"),d=u.filter('[data-type="values"]'),p=d.find("option"),h=this.views.parent.model.get("columns")
this.$select2=u,u.each(function(){var u,b=t(this),f={},y=b.data("select2"),g=[],m=[],v=b.data("select-type"),q=b.data("type"),w=b.val(),B=c.getMeta(),k=b.prop("multiple"),C=b.data("selected-options")
if(!e.length||-1!==e.indexOf(q)){if(c.options.columns[q]&&c.options.columns[q].select2&&c.options.columns[q].select2.tags){if(f.tags=!0,!y)switch(w=B.values,r=B.parameters&&"string"==typeof B.parameters&&conductor_query_builder.clauses[v]&&conductor_query_builder.clauses[v].parameters?conductor_query_builder.clauses[v].parameters:!1,r=r&&"string"==typeof B.parameters&&r[B.parameters]&&r[B.parameters].field?r[B.parameters].field:"string"==typeof B.parameters?B.parameters:!1,B.parameters&&!r&&(o=B.parameters.slice(0),r=o&&conductor_query_builder.clauses[v]&&conductor_query_builder.clauses[v].parameters&&conductor_query_builder.clauses[v].parameters?conductor_query_builder.clauses[v].parameters:!1,r=r&&r[o]&&r[o].field?r[o].field:!1),q){case"values":n=c.views.parent.getParameterData(w,o?o:B.parameters,r,v),i=c.views.parent.getOperators(n),s=c.views.parent.getValues(o?o:B.parameters,v),i&&i.length&&a.length&&(c.views.parent.updateOperatorsSelect(a,l,B.operators&&"string"==typeof B.operators?B.operators:B.operators.slice(0),i,!0),h&&h.values&&s&&(c.views.parent.updateValuesSelect(d,p,w,s,!0),p=d.find("option")),w&&w.length&&!_.isEqual(w,s)&&_.each(w,function(e){p.filter('[value="'+e+'"]').length||(f.hasOwnProperty("data")||(f.data=[]),f.data.push(e))}))}f.tokenSeparators=c.options.columns[q].select2.tags}switch(c.options.shortcode&&(f.dropdownParent=t("#TB_ajaxContent")),y&&y.isOpen()&&b.select2("close"),b.conductor_qb_select2(f),q){case"parameters":a.prop("disabled")&&B.parameters&&a.prop("disabled",!1),r=B.parameters&&"string"==typeof B.parameters&&conductor_query_builder.clauses[v]&&conductor_query_builder.clauses[v].parameters?conductor_query_builder.clauses[v].parameters:!1,r=r&&"string"==typeof B.parameters&&r[B.parameters]&&r[B.parameters].field?r[B.parameters].field:"string"==typeof B.parameters?B.parameters:!1,B.parameters&&!r&&(o=B.parameters.slice(0),r=o&&conductor_query_builder.clauses[v]&&conductor_query_builder.clauses[v].parameters&&conductor_query_builder.clauses[v].parameters?conductor_query_builder.clauses[v].parameters:!1,r=r&&r[o]&&r[o].field?r[o].field:!1),n=n?n:c.views.parent.getParameterData(w,o?o:B.parameters,r,v),i=!i&&n?c.views.parent.getOperators(n):i,i&&i.length&&a.length&&c.views.parent.updateOperatorsSelect(a,l,B.operators?B.operators&&"string"==typeof B.operators?B.operators:B.operators.slice(0):"",i,!0)
break
case"operators":h&&h.values&&(d.prop("disabled")&&conductor_query_builder.operators[w]&&("string"==typeof conductor_query_builder.operators[w]||conductor_query_builder.operators[w].type&&"bool"!==conductor_query_builder.operators[w].type)?d.prop("disabled",!1):!d.prop("disabled")&&conductor_query_builder.operators[w]&&"string"!=typeof conductor_query_builder.operators[w]&&conductor_query_builder.operators[w].type&&"bool"===conductor_query_builder.operators[w].type&&d.prop("disabled",!1))
break
case"values":B.values&&(w=b.val(),_.isEqual(w,B.values)||(b.val(B.values).trigger("change"),w=b.val())),k&&C&&c.updateSelect2Options(b)}y=b.data("select2"),u=y.$element.attr("class").split(/\s+/),u=u.map(function(e){return-1===e.indexOf("select2")?e:""}).filter(function(e){return e}),_.each(u,function(e){g.push(e+"-select2"),g.push(e+"-select2-container"),m.push(e+"-select2"),m.push(e+"-select2-results")}),g=g.join(" "),m=m.join(" "),y.$container.addClass(g),y.$results.addClass(m),c.setMetaValue(q,w)}})},maybeEnableActionButtons:function(){var e=this.$el.find(this.select2_selector)
e.each(function(){var e=t(this),o=e.val(),r=e.data("toggle-action-buttons")
return r&&o&&o.length?(c.trigger("conductor-qb-enable-action-buttons"),_.each(conductor_query_builder.Backbone.instances.views.clause_action_buttons,function(e){e.trigger("conductor-qb-enable-action-buttons")}),!1):void 0})},maybeSetModelID:function(e){e=e||!1
var t=this.model.get("id"),o=this.model.getIDFromView(this);(!t||o&&t!==o||e)&&this.model.setID(this,o)},maybeSetModelParentData:function(e){e=e||!1
var t=this.model.get("parent")
this.views.parent&&this.views.parent.model&&(-1!==t.count||-1===this.options.parent.count)&&(t.id!==this.model.get("id")||t.count!==this.views.parent.options.count||t.limit!==this.views.parent.model.get("limit")||e)&&this.model.setParentData(this)},setupMetaValues:function(){var e=this.model.get("parent"),t=-1!==e.count?e.count:-1,o=this.options.count,r=this.getMeta()
this.views.parent&&this.views.parent.options.meta&&-1!==t&&-1!==o&&(this.views.parent.options.meta[t]&&this.views.parent.options.meta[t][o]?(r=_.clone(conductor_query_builder.Backbone.defaults.meta),_.each(this.views.parent.options.meta[t][o],function(e,t){r[t]=e}),this.model.set("meta",r),this.options.meta=r):(r=_.clone(conductor_query_builder.Backbone.defaults.meta),this.model.set("meta",r),this.options.meta=r))},destroySelect2:function(){var e=this.$el.find(this.select2_selector)
e.each(function(){var o=t(this),r=o.data("select2")
r&&e.conductor_qb_select2("destroy")})},removeSubClauseGroup:function(e){e.preventDefault(),this.options["default"]||this.views.parent.removeSubClauseGroup(e,this)},render:function(t){return t=t||this.views.parent.options.flags.re_rendering||!1,this.maybeSetModelID(t),this.maybeSetModelParentData(t),this.options.count=t&&!this.views.parent.options.flags.re_rendering?this.options.count-1:this.getCurrentCount(!0),this.options.count=-1!==this.options.count?this.options.count:0,this.options.parent.count=this.views.parent&&this.views.parent.options.hasOwnProperty("count")?this.views.parent.options.count:-1,this.options.parent.limit=this.views.parent&&this.views.parent.options.hasOwnProperty("limit")?this.views.parent.options.limit:-1,this.options.parent_id=this.model.get("parent_id"),this.options.flags["default"]=0===this.options.count,this.views.parent&&_.isUndefined(this.views.parent.options.flags.sub_clause_groups)&&(this.options.flags.sub_clause_groups=!0),this.setupMetaValues(),e.Backbone.View.prototype.render.apply(this,arguments),t&&(this.listenToOnce(this,"ready",this.initializeSelect2),this.listenToOnce(this,"ready",this.maybeEnableActionButtons),this.trigger("ready")),this},remove:function(){var t,o,r=conductor_query_builder.Backbone.instances.views.sub_clauses,n=this.model.get("type"),i=this.views.parent,s=this.model.get("parent"),c=-1!==s.count?s.count:-1,u=this.options.count,l=this.el_selector
return this.destroySelect2(),a.remove(this.model),t=e.Backbone.View.prototype.remove.apply(this,arguments),o=r.map(function(e){return e.cid}).indexOf(this.cid),-1!==o&&r.splice(o,1),-1!==c&&-1!==u&&conductor_query_builder.meta[n][c]&&conductor_query_builder.meta[n][c]&&conductor_query_builder.meta[n][c][u]&&conductor_query_builder.meta[n][c].splice(u,1),i.options.flags.removing||_.each(i.views.get(l),function(e){-1!==e.options.count&&(e.options.parent.count!==c&&e.options.parent.count>c||e.options.count>u)&&e.render(!0)}),t},select2Change:function(e){var o=t(e.currentTarget),r=(o.data("select2"),o.val()),n=o.data("type"),i=o.data("toggle-action-buttons")
i&&(r&&r.length?(c.trigger("conductor-qb-enable-action-buttons"),_.each(conductor_query_builder.Backbone.instances.views.clause_action_buttons,function(e){e.trigger("conductor-qb-enable-action-buttons")})):(c.trigger("conductor-qb-disable-action-buttons"),_.each(conductor_query_builder.Backbone.instances.views.clause_action_buttons,function(e){e.trigger("conductor-qb-disable-action-buttons")}))),this.setMetaValue(n,r),this.views.parent.select2Change(e,this)},select2SelectUnselect:function(e){var o=t(e.currentTarget),r=-1,n=o.prop("multiple"),i=o.data("selected-options")||[],s=o.data("type"),c=e.params.data.id
if("values"===s&&n){switch(e.type){case"select2:select":i.push(c)
break
case"select2:unselect":r=i.indexOf(c),-1!==r&&i.splice(r,1)}o.data("selected",i).attr("selected-options",JSON.stringify(i)),this.updateSelect2Options(o)}},select2Close:function(e){var o=t(e.currentTarget)
this.options.shortcode&&!this.shortcode_select2_re_init&&(this.shortcode_select2_re_init=!0,function(e,o){setTimeout(function(){var r=o.$el.find(o.select2_selector).not(e),n=r.filter(function(){var e=t(this),o=e.data("select2"),r=o.$container
return r.hasClass("select2-container--open")})
o.initializeSelect2(o.views.parent.options.flags.re_init_values?[]:["parameters","operators"]),n.length&&n.each(function(){t(this).select2("open")}),o.shortcode_select2_re_init=!1},1)}(o,this))},getMeta:function(){return this.model.get("meta")},setMetaValue:function(e,t){var o=this.getMeta(),r=this.model.get("type"),n=this.model.get("parent"),i=-1!==n.count?n.count:-1,s=this.options.count
o[e]=t,this.model.set("meta",o),this.options.meta=o,-1!==i&&-1!==s&&(conductor_query_builder.meta[r][i]||(conductor_query_builder.meta[r][i]=[]),conductor_query_builder.meta[r][i][s]||(conductor_query_builder.meta[r][i][s]=_.clone(conductor_query_builder.Backbone.defaults.meta)),conductor_query_builder.meta[r][i][s][e]&&_.isEqual(conductor_query_builder.meta[r][i][s][e],t)||(conductor_query_builder.meta[r][i][s][e]=t))},getCurrentCount:function(e){e=e||!1
var t
return this.model.get("parent_id")?(t=a.where({parent_id:this.model.get("parent_id")}).length,t=e&&0!==t?t-1:t):-1},updateSelect2Options:function(e){var o=e.data("select2"),r=o.$container,n=r.find(".select2-selection__choice"),i=r.find(".select2-search"),s=e.data("selected-options")
s&&s.length&&_.each(s,function(e){i.before(n.filter(function(){return t(this).data("data").id===""+e}))})}}),conductor_query_builder.Backbone.Models.Shortcode=Backbone.Model.extend({defaults:{create_title:"",insert_query:"",insert_title:""},id_prefix:"conductor-qb-",initialize:function(){_.bindAll(this,"setID","removeFromInstances"),this.setID(),this.listenTo(this,"remove",this.removeFromInstances),this.listenTo(this,"remove",this.stopListening)},setID:function(){this.set("id",this.id_prefix+"shortcode")},removeFromInstances:function(){var e,t=conductor_query_builder.Backbone.instances.models.shortcode,o=this
e=t.map(function(e){return e.get("id")}).indexOf(o.get("id")),-1!==e&&t.splice(e,1)},getShortcode:function(e){e=e||{id:this.get("insert_query")}
var t=""
return e.id?(t+="["+conductor_query_builder.shortcode,_.each(e,function(e,o){e&&(t+=" "+o+'="'+e+'"')}),t+="]"):t}}),conductor_query_builder.Backbone.Collections.Shortcode=Backbone.Collection.extend({}),conductor_query_builder.Backbone.Views.Shortcode=e.Backbone.View.extend({el:"#conductor-qb-shortcode-wrapper",has_user_changed_feature_type:!1,feature_type_value:"",events:{"change .conductor-select-feature-type":"setHasUserChangedFeatureTypeFlag","click .conductor-qb-shortcode-tabs .nav-tab":"switchShortcodeActionButton","click .conductor-qb-shortcode-action-button":"shortcodeActionButton","change #conductor-qb-shortcode-insert-query":"setInsertQuery","keyup #conductor-qb-shortcode-insert-title":"setInsertTitle","change #conductor-qb-shortcode-insert-title":"setInsertTitle","keyup #conductor-qb-shortcode-create-title":"setCreateTitle","change #conductor-qb-shortcode-create-title":"setCreateTitle"},initialize:function(e){_.bindAll(this,"render","setHasUserChangedFeatureTypeFlag","switchShortcodeActionButton","shortcodeActionButton","setInsertQuery","setCreateTitle")},render:function(){return e.Backbone.View.prototype.render.apply(this,arguments),this},reset:function(){this.$el.find("#conductor-qb-shortcode-insert-title").val("").change(),this.$el.find("#conductor-qb-shortcode-insert-query").val("").change(),this.$el.find("#conductor-qb-shortcode-create-title").val("").change()},setHasUserChangedFeatureTypeFlag:function(e){this.feature_type_value=t(e.currentTarget).val(),this.has_user_changed_feature_type||(this.has_user_changed_feature_type=!0)},switchShortcodeActionButton:function(e){var o=t(e.currentTarget),r=o.data("shortcode-action")
h.options.button_type=r,h.options.label=conductor_query_builder.l10n.shortcode[r],h.render(),this.maybeToggleActionButton(r)},maybeToggleActionButton:function(e){var t,o=h.$el.find(".conductor-qb-shortcode-action-button")
switch(e=e||o.data("type")){case"insert":t=this.model.get("insert_query"),t||o.prop("disabled")?t&&o.prop("disabled")&&h.enableActionButton():h.disableActionButton()
break
case"create":t=this.model.get("create_title"),t||o.prop("disabled")?t&&o.prop("disabled")&&h.enableActionButton():h.disableActionButton()}},shortcodeActionButton:function(o){var r,n=t(o.currentTarget),i=n.data("type")
switch(o.preventDefault(),h.$el.find(".conductor-qb-loading").addClass("is-active conductor-qb-spinner-is-active"),i){case"insert":r=this.model.getShortcode({id:this.model.get("insert_query"),title:this.model.get("insert_title")}),r?send_to_editor(r):tb_remove(),h.$el.find(".conductor-qb-loading").removeClass("is-active conductor-qb-spinner-is-active")
break
case"create":e.ajax.post(conductor_query_builder.ajax.shortcode.action,this.ajax.setupAJAXData(conductor_query_builder.ajax.shortcode.nonce,conductor_query_builder.ajax.shortcode.action)).done(this.ajax.success).fail(this.ajax.fail),h.disableActionButton()}},setInsertQuery:function(e){var o=t(e.currentTarget),r=o.val()
this.model.set("insert_query",r),this.maybeToggleActionButton()},setInsertTitle:function(e){var o=t(e.currentTarget),r=o.val()
this.model.set("insert_title",r)},setCreateTitle:function(e){var o=t(e.currentTarget),r=o.val()
this.model.set("create_title",r),this.maybeToggleActionButton()},ajax:{data:{conductor_query_builder:1},setupAJAXData:function(e,t){return i.ajax.setupAJAXData(-1,e,t,p.$el.find(".conductor-qb-shortcode-create-form"))},success:function(e){var t=p.model.getShortcode({id:e.ID,title:e.title})
t?(send_to_editor(t),conductor_query_builder.queries.push({ID:e.ID,post_title:e.title}),b.render()):tb_remove(),h.$el.find(".conductor-qb-loading").removeClass("is-active conductor-qb-spinner-is-active")},fail:function(e){h.enableActionButton()}},isSimpleQueryArgsEmpty:function(){var e=this.$el.find(".widget"),o=e.find(".conductor-section-general"),r=!0
return"simple"!==window.getUserSetting(conductor_query_builder.user.settings["query-builder"].mode.name)?!1:(o.find(":input").each(function(){var e,o=t(this),n=o.val()
if(r)switch(this.nodeName.toLowerCase()){case"input":n!==this.defaultValue&&(r=!1)
break
case"select":e=o.find('option[value="'+n+'"]'),o.find('option[value="'+n+'"]')[0].defaultSelected||0===e.index()||(r=!1)}}),r)}}),conductor_query_builder.Backbone.Views.Shortcode_Actions=e.Backbone.View.extend({id:"conductor-qb-shortcode-actions-inner",el_selector:"#conductor-qb-shortcode-actions",template:e.template("conductor-qb-shortcode-query-builder-actions"),initialize:function(e){_.bindAll(this,"render")},render:function(){return e.Backbone.View.prototype.render.apply(this,arguments),this},disableActionButton:function(){var e=this.$el.find(".conductor-qb-shortcode-action-button")
e.prop("disabled",!0)},enableActionButton:function(){var e=this.$el.find(".conductor-qb-shortcode-action-button")
e.prop("disabled",!1)}}),conductor_query_builder.Backbone.Views.Shortcode_Insert=e.Backbone.View.extend({id:"conductor-qb-shortcode-insert-inner",el_selector:"#conductor-qb-shortcode-insert",select2_selector:".conductor-qb-select2",template:e.template("conductor-qb-shortcode-query-builder-insert"),initialize:function(e){_.bindAll(this,"render")},render:function(){return e.Backbone.View.prototype.render.apply(this,arguments),this.initializeSelect2(),this},reset:function(){this.$el.find("#conductor-qb-shortcode-insert-title").val("").change(),this.$el.find("#conductor-qb-shortcode-insert-query").val("").change(),this.$el.find("#conductor-qb-shortcode-create-title").val("").change(),this.destroySelect2()},initializeSelect2:function(){var e=this
setTimeout(function(){e.$el.find(e.select2_selector).conductor_qb_select2({dropdownParent:t("#TB_ajaxContent")})},1)},destroySelect2:function(){var e=this.$el.find(this.select2_selector)
e.each(function(){var o=t(this),r=o.data("select2")
r&&e.conductor_qb_select2("destroy")})}}),conductor_query_builder.Backbone.Views.Shortcode_Create_Title=e.Backbone.View.extend({id:"conductor-qb-shortcode-create-title-inner",el_selector:"#conductor-qb-shortcode-create-title-content",template:e.template("conductor-qb-shortcode-query-builder-create-title"),initialize:function(e){_.bindAll(this,"render")},render:function(){return e.Backbone.View.prototype.render.apply(this,arguments),this}}),t(function(){var e,i=t("#post"),s=t(".conductor-qb-tabs a"),c=t(".conductor-qb-add-shortcode")
r=t(document),o=t("body"),n=t("#conductor-query-builder-preview"),s.on("click.conductor-qb",function(e){var o=t(this),r=o.siblings(),n=o.parents(".conductor-qb-tabs-wrapper"),i=n.next(".conductor-qb-tab-content-wrapper").find(".conductor-qb-tab"),s=o.attr("href")
i=i.filter('[data-type="'+o.data("type")+'"]'),e.preventDefault(),r.removeClass("nav-tab-active"),i.removeClass("active"),o.addClass("nav-tab-active"),t(s).addClass("active")}),conductor_query_builder.flags.is_query_builder_post_type&&conductor_query_builder.fn.query_builder.init(),c.on("click.conductor-qb",function(e){o.addClass("conductor-shortcode-ui-visible"),p?(conductor_query_builder.fn.shortcode.reset(),b.render(),conductor_query_builder.fn.query_builder.reset()):(conductor_query_builder.fn.shortcode.init(),conductor_query_builder.fn.query_builder.init(!0)),tb_show(conductor_query_builder.l10n.shortcode.title,"#TB_inline?inlineId=conductor-qb-shortcode-wrapper-container&width=753&height=480",!1)}),o.on("thickbox:removed",function(){o.hasClass("conductor-shortcode-ui-visible")&&(conductor_query_builder.fn.shortcode.reset(),conductor_query_builder.fn.query_builder.reset(),p.$el.find(".conductor-qb-tabs .nav-tab:first-child").trigger("click"),conductor_query_builder.fn.conductor.widget.reset(),setTimeout(function(){o.removeClass("conductor-shortcode-ui-visible")},1))}),r.on("keydown.conductor-qb",".select2-search__field, .select2-search--inline",function(e){o.hasClass("conductor-shortcode-ui-visible")&&27===e.which&&e.stopImmediatePropagation()}),r.on("keydown.conductor-qb",function(e){o.hasClass("conductor-shortcode-ui-visible")&&27===e.which&&(a.isMetaEmpty()||window.confirm(conductor_query_builder.l10n.shortcode.confirm)||e.stopImmediatePropagation())}),e=new MutationObserver(function(e){o.hasClass("conductor-shortcode-ui-visible")&&_.each(e,function(e){e.addedNodes&&e.addedNodes.length&&_.each(e.addedNodes,function(e){if("TB_window"===e.id){var r=t("#TB_overlay, #TB_closeWindowButton")
r.on("click.conductor-qb",function(e){o.hasClass("conductor-shortcode-ui-visible")&&(a.isMetaEmpty()&&p.isSimpleQueryArgsEmpty()||window.confirm(conductor_query_builder.l10n.shortcode.confirm)||e.stopImmediatePropagation())}),r.each(function(){var e,o=(t(this),jQuery._data(this,"events")),r=-1
o&&o.click&&o.click.length&&(_.each(o.click,function(e,t){"conductor-qb"===e.namespace&&(r=t)}),-1!==r&&(e=o.click.splice(r,1),e.length&&o.click.splice(0,0,e[0])),jQuery._data(this,"events",o))})}})})}),e.observe(o[0],{childList:!0}),i.submit(function(e){var o=t(".conductor-qb-select2")
o.each(function(){var e=t(this),o=e.data("type"),r=e.prop("multiple"),n=e.data("selected-options")
"values"===o&&r&&n.length&&_.each(n.reverse(),function(t){var o=e.find('option[value="'+t+'"]')
o.length&&e.prepend(o)})})})})}(wp,jQuery)
